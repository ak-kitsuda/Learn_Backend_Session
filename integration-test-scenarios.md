# 統合テストシナリオ - Todo App（セッション/クッキーベース認証）

## 📋 テスト概要

**プロジェクト**: セッション/クッキーベース認証学習プロジェクト  
**技術スタック**: Vue.js 3 + Express.js + SQLite  
**テスト対象**: Phase3 Step3 完了後の全機能  
**最終更新**: メールアドレス入力欄追加対応済み

---

## 🚀 事前準備

### サーバー起動確認

```bash
# バックエンドサーバー起動
cd backend && npm run dev
# ✅ ポート3000で起動確認

# フロントエンドサーバー起動（別ターミナル）
cd frontend && npm run serve
# ✅ ポート8080で起動確認
# ⚠️ 初回起動時にVue.jsの警告が表示される場合がありますが、アプリケーションは正常に動作します
```

### ブラウザ準備

- **推奨ブラウザ**: Chrome、Firefox、Safari
- **開発者ツール**: F12 で開いておく（Network、Console、Application タブを使用）
- **プライベートモード**: 推奨（既存のセッション・クッキーの影響を排除）

---

## 🧪 テストシナリオ

### シナリオ 1: 新規ユーザー登録 ✨

#### 1-1. 登録ページアクセス

**操作手順**:

1. ブラウザで `http://localhost:8080` にアクセス
2. 「新規登録」ボタンをクリック
3. `/register` ページに遷移

**期待結果**:

- ✅ 美しいグラデーション背景の登録ページが表示
- ✅ 4 つの入力欄が表示される：
  - ユーザー名（プレースホルダー: ユーザー名を入力（3 文字以上））
  - **メールアドレス**（プレースホルダー: メールアドレスを入力）
  - パスワード（プレースホルダー: パスワードを入力（6 文字以上））
  - パスワード確認（プレースホルダー: パスワードを再入力）
- ✅ 「✨ 新規登録」ボタンが表示
- ✅ 「🚀 ログイン」リンクが表示

#### 1-2. バリデーションテスト

**操作手順**:

1. **ユーザー名**: `te`（2 文字）を入力
2. **メールアドレス**: `test@example.com`を入力
3. **パスワード**: `12345`（5 文字）を入力
4. **パスワード確認**: `12345`を入力
5. 「✨ 新規登録」ボタンをクリック

**期待結果**:

- ❌ エラーメッセージ: 「ユーザー名は 3 文字以上で入力してください」

**操作手順（続き）**: 6. **ユーザー名**: `testuser`に修正 7. **メールアドレス**: `invalid-email`に変更 8. 「✨ 新規登録」ボタンをクリック

**期待結果**:

- ❌ エラーメッセージ: 「有効なメールアドレスを入力してください」

**操作手順（続き）**: 9. **メールアドレス**: `test@example.com`に修正 10. **パスワード**: `password123`に変更 11. **パスワード確認**: `password456`（不一致）に入力 12. 「✨ 新規登録」ボタンをクリック

**期待結果**:

- ❌ エラーメッセージ: 「パスワードが一致しません」

#### 1-3. 正常登録テスト

**操作手順**:

1. **ユーザー名**: `testuser`
2. **メールアドレス**: `test@example.com`
3. **パスワード**: `password123`
4. **パスワード確認**: `password123`
5. 「✨ 新規登録」ボタンをクリック

**期待結果**:

- ✅ 成功メッセージ: 「ユーザー登録が完了しました！Todo 一覧ページに移動します...」
- ✅ 2 秒後に自動的に `/todos` ページに遷移
- ✅ 開発者ツール（Network）で `/api/auth/register` の POST リクエスト成功（201）
- ✅ 開発者ツール（Application > Cookies）でセッションクッキーが設定される

---

### シナリオ 2: ユーザーログイン 🚀

#### 2-1. ログインページ確認

**操作手順**:

1. `/login` ページが表示されていることを確認

**期待結果**:

- ✅ 美しいグラデーション背景のログインページが表示
- ✅ 2 つの入力欄が表示される：
  - ユーザー名
  - パスワード
- ✅ 「🚀 ログイン」ボタンが表示
- ✅ 「✨ 新規登録」リンクが表示

#### 2-2. ログイン実行

**操作手順**:

1. **ユーザー名**: `testuser`
2. **パスワード**: `password123`
3. 「🚀 ログイン」ボタンをクリック

**期待結果**:

- ✅ ログイン成功
- ✅ 成功メッセージ: 「ログインしました！Todo 一覧ページに移動します...」
- ✅ 1.5 秒後に自動的に `/todos` ページに遷移
- ✅ 開発者ツール（Network）で `/api/auth/login` の POST リクエスト成功（200）
- ✅ レスポンスに `user` オブジェクト（id, username, email）が含まれる

---

### シナリオ 3: Todo 管理機能 📝

#### 3-1. Todo 一覧ページ確認

**操作手順**:

1. `/todos` ページが表示されていることを確認

**期待結果**:

- ✅ 「📝 Todo App」タイトルが表示
- ✅ 「こんにちは、testuser さん！」の歓迎メッセージ
- ✅ Todo 作成フォームが表示（タイトル、説明、優先度選択、➕ 追加ボタン）
- ✅ 統計情報エリアが表示（総数: 0, 完了: 0, 未完了: 0）
- ✅ 「🚪 ログアウト」ボタンが表示
- ✅ 「まだ Todo がありません」メッセージが表示

#### 3-2. Todo 作成テスト

**操作手順**:

1. **タイトル**: `学習計画を立てる`
2. **説明**: `Vue.js とExpress.jsの学習スケジュールを作成する`
3. **優先度**: `🔴 高`を選択
4. 「➕ 追加」ボタンをクリック

**期待結果**:

- ✅ Todo が一覧に追加される
- ✅ 統計情報が更新される（総数: 1, 完了: 0, 未完了: 1）
- ✅ フォームがクリアされる
- ✅ 開発者ツール（Network）で `/api/todos` の POST リクエスト成功（201）

**操作手順（続き）**: 5. 2 つ目の Todo 作成:

- **タイトル**: `データベース設計確認`
- **説明**: `SQLiteのテーブル構造を確認する`
- **優先度**: `🟡 中`

6. 3 つ目の Todo 作成:
   - **タイトル**: `UI改善案検討`
   - **説明**: `ユーザビリティ向上のための改善点を考える`
   - **優先度**: `🟢 低`

**期待結果**:

- ✅ 3 つの Todo が一覧に表示される
- ✅ 優先度順にソートされている（高 → 中 → 低）
- ✅ 統計情報: 総数: 3, 完了: 0, 未完了: 3

#### 3-3. Todo 操作テスト

**操作手順**:

1. 1 つ目の Todo（学習計画を立てる）の「⚪」ボタンをクリック

**期待結果**:

- ✅ Todo が完了状態に変更される（取り消し線、グレーアウト）
- ✅ ボタンが「↩️」に変更される
- ✅ 統計情報が更新される（総数: 3, 完了: 1, 未完了: 2）
- ✅ ソート順が変更される（完了済みが下に移動）

**操作手順（続き）**: 2. 3 つ目の Todo（UI 改善案検討）の「🗑️」ボタンをクリック

**期待結果**:

- ✅ Todo が一覧から削除される
- ✅ 統計情報が更新される（総数: 2, 完了: 1, 未完了: 1）

**操作手順（続き）**: 3. 完了済みの Todo（学習計画を立てる）の「↩️」ボタンをクリック

**期待結果**:

- ✅ Todo が未完了状態に戻る
- ✅ ボタンが「⚪」に戻る
- ✅ 統計情報が更新される（総数: 2, 完了: 0, 未完了: 2）
- ✅ ソート順が変更される（優先度順に戻る）

---

### シナリオ 4: 認証・認可テスト 🔐

#### 4-1. ログアウトテスト

**操作手順**:

1. Todo 一覧ページで「🚪 ログアウト」ボタンをクリック

**期待結果**:

- ✅ 自動的に `/login` ページに遷移
- ✅ 開発者ツール（Network）で `/api/auth/logout` の POST リクエスト成功（200）
- ✅ 開発者ツール（Application > Cookies）でセッションクッキーが削除される

#### 4-2. 認証保護テスト

**操作手順**:

1. ログアウト状態で直接 `http://localhost:8080/todos` にアクセス

**期待結果**:

- ✅ 自動的に `/login` ページにリダイレクトされる
- ✅ URL が `/login?redirect=/todos` に変更される（リダイレクト先が保存される）

**操作手順（続き）**: 2. ブラウザの戻るボタンを押す、または直接 `http://localhost:8080/` にアクセス

**期待結果**:

- ✅ ログインページが表示される（認証が必要）

#### 4-3. セッション復元テスト

**操作手順**:

1. 再度ログイン（testuser / password123）
2. Todo 一覧ページに遷移後、ブラウザを一度閉じる
3. 新しいブラウザウィンドウで `http://localhost:8080/todos` にアクセス

**期待結果**:

- ✅ セッションが維持されている場合、Todo 一覧ページが表示される
- ❌ セッションが切れている場合、ログインページにリダイレクトされる

---

### シナリオ 5: エラーハンドリングテスト ⚠️

#### 5-1. 重複ユーザー登録テスト

**操作手順**:

1. `/register` ページにアクセス
2. 既存のユーザー情報で登録を試行:
   - **ユーザー名**: `testuser`
   - **メールアドレス**: `test@example.com`
   - **パスワード**: `password123`
   - **パスワード確認**: `password123`
3. 「✨ 新規登録」ボタンをクリック

**期待結果**:

- ❌ エラーメッセージ: 「ユーザー名またはメールアドレスが既に使用されています」

#### 5-2. 不正ログインテスト

**操作手順**:

1. `/login` ページで間違った認証情報を入力:
   - **ユーザー名**: `wronguser`
   - **パスワード**: `wrongpassword`
2. 「🚀 ログイン」ボタンをクリック

**期待結果**:

- ❌ エラーメッセージ: 「ユーザー名またはパスワードが間違っています」

#### 5-3. バックエンドサーバー停止テスト

**操作手順**:

1. バックエンドサーバーを停止（Ctrl+C）
2. フロントエンドで Todo 作成を試行

**期待結果**:

- ❌ 適切なエラーメッセージが表示される
- ✅ アプリケーションがクラッシュしない

---

### シナリオ 6: レスポンシブデザインテスト 📱

#### 6-1. モバイル表示テスト

**操作手順**:

1. 開発者ツールでデバイスモードを有効化
2. iPhone SE、iPad、Galaxy S8 などの画面サイズに変更
3. 各ページ（登録、ログイン、Todo 一覧）を確認

**期待結果**:

- ✅ 全てのページが適切にレスポンシブ表示される
- ✅ 入力フォームが使いやすい
- ✅ ボタンがタップしやすいサイズ
- ✅ 文字が読みやすい

---

## 🔍 開発者ツールでの確認ポイント

### Network タブ

- **登録時**: `POST /api/auth/register` → 201 Created
- **ログイン時**: `POST /api/auth/login` → 200 OK
- **Todo 取得**: `GET /api/todos` → 200 OK
- **Todo 作成**: `POST /api/todos` → 201 Created
- **Todo 更新**: `PUT /api/todos/:id` → 200 OK
- **Todo 削除**: `DELETE /api/todos/:id` → 200 OK
- **ログアウト**: `POST /api/auth/logout` → 200 OK

### Console タブ

- エラーメッセージが表示されていないことを確認
- 適切なログメッセージが出力されていることを確認

### Application タブ > Cookies

- セッションクッキー（`connect.sid`）の設定・削除を確認
- クッキーの有効期限（24 時間）を確認

---

## 📊 テスト結果記録

### ✅ 成功ケース

- [ ] シナリオ 1: 新規ユーザー登録
- [ ] シナリオ 2: ユーザーログイン
- [ ] シナリオ 3: Todo 管理機能
- [ ] シナリオ 4: 認証・認可テスト
- [ ] シナリオ 5: エラーハンドリング
- [ ] シナリオ 6: レスポンシブデザイン

### ❌ 失敗ケース

記録エリア:

```
日時:
シナリオ:
エラー内容:
再現手順:
```

---

## 🎯 学習ポイント

### セッション/クッキーベース認証

- ✅ セッションの作成・維持・削除
- ✅ クッキーの自動送信
- ✅ CSRF 対策の理解
- ✅ セッションストレージ（SQLite）

### Vue.js 3 (Composition API)

- ✅ `<script setup>` 構文
- ✅ リアクティブデータ管理
- ✅ Vue Router 4.x
- ✅ Axios 統合

### Express.js + SQLite

- ✅ RESTful API 設計
- ✅ データベース操作
- ✅ ミドルウェア活用
- ✅ エラーハンドリング

---

## 🚀 次のステップ

テスト完了後の学習継続案:

1. **セキュリティ強化**: CSRF 対策、XSS 対策の実装
2. **パフォーマンス最適化**: ページネーション、キャッシュ戦略
3. **機能拡張**: カテゴリ機能、検索機能、ファイル添付
4. **デプロイメント**: 本番環境へのデプロイ体験

---

**📝 備考**: このテストシナリオは学習目的で作成されています。本番環境では追加のセキュリティテストやパフォーマンステストが必要です。
